name: JWT ìë™ìƒì„± ë° ì´ë©”ì¼ ë°œì†¡

on:
  schedule:
    - cron: '*/5 * * * *'  # 5ë¶„
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    env:
      APPLICATION_ID: ${{ secrets.APPLICATION_ID }}
      PRIVATE_KEY: ${{ secrets.PRIVATE_KEY }}

    steps:
      - name: ì½”ë“œ ë‹¤ìš´ë¡œë“œ
        uses: actions/checkout@v3

      - name: Node.js ì„¤ì¹˜
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: íŒ¨í‚¤ì§€ ì„¤ì¹˜
        run: npm install

      - name: í˜„ì¬ ì‹œê°„ ì¶œë ¥
        run: |
          echo "ğŸ•’ í˜„ì¬ ì‹œê°„ (UTC):"
          date -u
          echo "ğŸ•’ í˜„ì¬ ì‹œê°„ (JST):"
          TZ=Asia/Tokyo date

      - name: JWT ìƒì„± ë° ì €ì¥
        run: node index.js

      - name: ì´ë©”ì¼ ì „ì†¡ì„ ìœ„í•œ Python ì„¤ì¹˜
        run: |
          sudo apt-get update
          sudo apt-get install -y python3 python3-pip
          pip3 install yagmail

      - name: JWT ì´ë©”ì¼ ì „ì†¡
        env:
          MAIL_USERNAME: ${{ secrets.MAIL_USERNAME }}
          MAIL_PASSWORD: ${{ secrets.MAIL_PASSWORD }}
          MAIL_TO: ${{ secrets.MAIL_TO }}
        run: |
          echo "ğŸ“¤ ì´ë©”ì¼ ì „ì†¡ ì‹œì‘..."
          python3 .github/scripts/send_jwt_email.py
